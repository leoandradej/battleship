(()=>{"use strict";const e=class{constructor(e){this.name=e,this.hits=[],this.sunkShips=[]}},t=class{constructor(t){this.gridCellSize=t,this.player=new e("player"),this.computer=new e("computer"),this.createGameboard(this.player.name),this.createGameboard(this.computer.name),this.angle=0,this.draggedShip,this.notDropped,this.gameOver=!1,this.playerTurn}createGameboard(e){const t=document.querySelector("[data-gameboards-container]"),r=document.createElement("div");r.className="gameboard",r.id=e;for(let e=0;e<this.gridCellSize*this.gridCellSize;e++){const t=document.createElement("div");t.className="cell",t.id=e,r.append(t)}t.append(r)}placeShip(e,t,r){const s=document.querySelectorAll(`#${e} div`);let i,a=Math.random()<.5,o="player"===e?0===this.angle:a,n=Math.floor(Math.random()*this.gridCellSize*this.gridCellSize),l=r||n,c=o?l<=this.gridCellSize*this.gridCellSize-t.length?l:this.gridCellSize*this.gridCellSize-t.length:l<=this.gridCellSize*this.gridCellSize-this.gridCellSize*t.length?l:l-t.length*this.gridCellSize+this.gridCellSize,h=[];for(let e=0;e<t.length;e++)o?h.push(s[Number(c)+e]):h.push(s[Number(c)+e*this.gridCellSize]);o?h.every(((e,t)=>i=h[0].id%this.gridCellSize!=this.gridCellSize-(h.length-(t+1)))):h.every(((e,t)=>i=h[0].id<this.gridCellSize*t+1+90));const d=h.every((e=>!e.classList.contains("taken")));i&&d?h.forEach((e=>{e.classList.add(t.name),e.classList.add("taken")})):("computer"===e&&this.placeShip(e,t,r),"player"===e&&(this.notDropped=!0))}checkScore=(e,t,r)=>{const s=document.querySelector("[data-display-info]"),i=(i,a)=>{t.filter((e=>e===i)).length===a&&("player"===e&&(s.textContent=`You have sunk computer's ${i}`,this.player.hits=t.filter((e=>e!==i))),"computer"===e&&(s.textContent=`Computer has sunk your ${i}`,this.computer.hits=t.filter((e=>e!==i))),r.push(i))};i("destroyer",2),i("submarine",3),i("cruiser",3),i("battleship",4),i("carrier",5),5===this.player.sunkShips.length&&(s.textContent="You have sunk all computer's ships. You Won!",this.gameOver=!0),5===this.computer.sunkShips.length&&(s.textContent="Computer has sunk all your ships. You Lose!",this.gameOver=!0)}},r=class{constructor(e,t){this.name=e,this.length=t}},s=new r("destroyer",2),i=new r("submarine",3),a=new r("cruiser",3),o=new r("battleship",4),n=new r("carrier",5);(()=>{const e=new t(10);document.querySelector(".rotate-ship").addEventListener("click",(()=>{const t=document.querySelector("[data-ships]"),r=Array.from(t.children);e.angle=0===e.angle?90:0,r.forEach((t=>t.style.transform=`rotate(${e.angle}deg)`))}));const r=[s,i,a,o,n];r.forEach((t=>e.placeShip(e.computer.name,t)));const l=t=>{e.notDropped=!1,e.draggedShip=t.target},c=e=>{e.preventDefault()},h=t=>{const s=t.target.id,i=r[e.draggedShip.id];e.placeShip(e.player.name,i,s),e.notDropped||e.draggedShip.remove()},d=document.querySelector("[data-ships-container]");Array.from(d.children).forEach((e=>e.addEventListener("dragstart",l))),document.querySelectorAll(`#${e.player.name} div`).forEach((e=>{e.addEventListener("dragover",c),e.addEventListener("drop",h)}));const u=()=>{const t=document.querySelector("[data-display-info]"),r=document.querySelector("[data-display-turn]");e.gameOver||(r.textContent="Computers Turn",t.textContent="The Computer is thinking...",setTimeout((()=>{let r=Math.floor(Math.random()*e.gridCellSize*e.gridCellSize);const s=document.querySelectorAll("#player div");if(s[r].classList.contains("taken")&&s[r].classList.contains("boom"))u();else if(s[r].classList.contains("taken")&&!s[r].classList.contains("boom")){s[r].classList.add("boom"),t.textContent="The Computer hit your ship!";let i=Array.from(s[r].classList);e.computer.hits.push(...i.filter((e=>"cell"!==e&&"taken"!==e&&"boom"!==e))),e.checkScore(e.computer.name,e.computer.hits,e.computer.sunkShips)}else t.textContent="Nothing hit this time.",s[r].classList.add("miss")}),3e3),setTimeout((()=>{e.playerTurn=!0,r.textContent="Your Turn!",t.textContent="Please make your move.",document.querySelectorAll("#computer div").forEach((e=>e.addEventListener("click",p)))}),6e3))},p=t=>{const r=document.querySelector("[data-display-info]");if(!e.gameOver&&t.target.classList.contains("taken")){t.target.classList.add("boom"),r.textContent="You hit the Computers ship!";let s=Array.from(t.target.classList);e.player.hits.push(...s.filter((e=>"cell"!==e&&"taken"!==e&&"boom"!==e))),e.checkScore(e.player.name,e.player.hits,e.player.sunkShips),console.log("gb-hits",e.player.hits),console.log("gb-sunk",e.player.sunkShips)}t.target.classList.contains("taken")||(r.textContent="Nothing hit this time.",t.target.classList.add("miss")),e.playerTurn=!1,document.querySelectorAll("#computer div").forEach((e=>e.replaceWith(e.cloneNode(!0)))),setTimeout(u,3e3)};document.querySelector(".start-btn").addEventListener("click",(()=>{if(void 0===e.playerTurn){const t=document.querySelector("[data-ships]"),r=document.querySelector("[data-display-info]"),s=document.querySelector("[data-display-turn]");0!=t.children.length?r.textContent="Please place all your ships first!":(document.querySelectorAll("#computer div").forEach((e=>e.addEventListener("click",p))),e.playerTurn=!0,s.textContent="Your Turn!",r.textContent="The Game has Started")}}))})()})();